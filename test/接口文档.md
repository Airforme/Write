# 接口文档
## 1.保存造价数据(一个构件只许保存一次)
### 请求URL

>/4DAnalog/cost/saveCostDetail.action

### 请求方式

> POST

### 参数

|     参数名      | 必选 |  类型  |          说明          |                    示例                     |
| -------------- | ---- | ------ | ---------------------- | ------------------------------------------- |
| modelId        | 是   | int    | 模型ID                 | 1326]                                       |
| version        | 是   | int    | 模型版本               | 1                                           |
| dbid           | 是   | string | 构件ID (逗号","相隔)    | 6124,4944,6070,7396,6577                    |
| measureUnit    | 是   | string | 计量单位               | mm                                          |
| flowid         | 是   | string | 流程主键               | 3                                           |
| projectCode    | 是   | string | 清单项目编码            | 451354136156                                |
| projectFeature | 否   | string | 清单项目特征            | 计量面积                                     |
| unitPrice      | 是   | double | 综合单价               | 123.0                                       |
| mapUnit        | 是   | string | 映射单位               | 面积 (面积,长度,体积 中三选一)                 |
| tempPrice      | 是   | double | 暂估价                 | 100.0                                       |
| projectName    | 是   | string | 清单项目名称            | 柱子的造价                                   |
| contractId     | 是   | String | 合同版本号              | 1245124453                                  |
| dbidCode       | 否   | string | 构件全编码(目前没有使用) | 01.01.02.01_04.03.03.01_02.0001.0010_000635 |

    所有传输的参数需要使用UTF-8编码
### 返回示例

```json
{
    "msg": "接口调用成功",
    "code": "200",
    "data": "",
    "dataEncode": false
}
```

### 返回参数说明

| 参数名  |   值    |   说明   |
| ---- | ------ | ------ |
| code |  200   |  查询成功  |
|      |  502   |  参数错误  |
|      |  500   | 服务端报错  |
| msg  | 接口调用成功 | 返回结果说明 |


### 备注

> code返回结果取值有200,502,500三种可能

## 2.发起中间计量流程

### 请求URL

> /4DAnalog/cost/getMeasureFlow.action

### 请求方式

> POST

### 参数

|  参数名  | 必选 |  类型  |      说明       |                           示例                           |
| ------- | --- | ------ | --------------- | ------------------------------------------------------- |
| dbid    | 是   | String | 构件Id(逗号相隔) | 137996,135341,136672,133067,133068,133085,140478,140479 |
| modelId | 是   | int    | 模型Id          | 1326                                                    |
| version | 是   | int    | 模型版本         | 1                                                       |

    dbid参数需要UTF-8进行编码
### 返回示例

```json
{
    "msg": "接口调用成功",
    "code": "200",
    "data": [
        {
            "_id":"清单项目编码4",
            "projectName":"清单项目名称4",
            "projectFeature":"清单项目特征4",
            "measureUnit":"计量单位4",
            "unitPrice":444.0,
            "sum":104.0,
            "dbid":[133068,133067,133085],
            "modelId":1326,
            "version":1
        }
    ],
    "dataEncode": false
}
```
###    返回参数说明

|     参数名      |           值           |    说明     |
| -------------- | ---------------------- | ----------- |
| code           | 200                    | 查询成功     |
|                | 502                    | 参数错误     |
|                | 500                    | 服务端报错  |
| msg            | 接口调用成功            | 返回结果说明 |
| _id            | 清单项目编码4           | 清单项目编码 |
| projectName    | 清单项目名称4           | 清单项目名称 |
| projectFeature | 清单项目特征4           | 清单项目特征 |
| measureUnit    | 计量单位4               | 计量单位     |
| unitPrice      | 444.0                  | 综合单价     |
| sum            | 104.0                  | 工程量      |
| modelId        | 1326                   | 模型ID      |
| version        | 1                      | 模型版本     |
| dbid           | [133068,133067,133085] | 构件ID      |

### 备注

> code返回结果取值有200,502,500三种可能

## 3.中间计量流程已完成

### 请求URL

> /4DAnalog/cost/measureFlowDone.action

### 请求方式

> POST

### 参数

|  参数名  | 必选 |  类型  |      说明       |                           示例                           |
| ------- | --- | ------ | --------------- | ------------------------------------------------------- |
| dbid    | 是   | String | 构件Id(逗号相隔) | 137996,135341,136672,133067,133068,133085,140478,140479 |
| modelId | 是   | int    | 模型Id          | 1326                                                    |
| version | 是   | int    | 模型版本         | 1                                                       |

    dbid参数需要UTF-8进行编码
### 返回示例

```json
{
    "msg": "接口调用成功",
    "code": "200",
    "data": "",
    "dataEncode": false
}
```

### 返回参数说明

| 参数名 |     值      |    说明     |
| ----- | ----------- | ----------- |
| code  | 200         | 查询成功     |
|       | 502         | 参数错误     |
|       | 500         | 服务端报错   |
| msg   | 接口调用成功 | 返回结果说明 |

### 备注

> code返回结果取值有200,502,500三种可能


## 4.发起造价流程(已计量过的)

### 请求URL

> /4DAnalog/cost/getPayFlow.action

### 请求方式

> POST

### 参数

|  参数名  | 必选 |  类型  |      说明       |                           示例                           |
| ------- | --- | ------ | --------------- | ------------------------------------------------------- |
| dbid    | 是   | String | 构件Id(逗号相隔) | 137996,135341,136672,133067,133068,133085,140478,140479 |
| modelId | 是   | int    | 模型Id          | 1326                                                    |
| version | 是   | int    | 模型版本         | 1                                                       |

    dbid参数需要UTF-8进行编码
### 返回示例

```json
{
    "msg": "接口调用成功",
    "code": "200",
    "data": [
        {
            "_id":"清单项目编码4",
            "projectName":"清单项目名称4",
            "projectFeature":"清单项目特征4",
            "measureUnit":"计量单位4",
            "unitPrice":444.0,
            "sum":104.0,
            "dbid":[133068,133067,133085],
            "modelId":1326,
            "version":1
        }
    ],
    "dataEncode": false
}
```
###    返回参数说明

|     参数名      |           值           |    说明     |
| -------------- | ---------------------- | ----------- |
| code           | 200                    | 查询成功     |
|                | 502                    | 参数错误     |
|                | 500                    | 服务端报错  |
| msg            | 接口调用成功            | 返回结果说明 |
| _id            | 清单项目编码4           | 清单项目编码 |
| projectName    | 清单项目名称4           | 清单项目名称 |
| projectFeature | 清单项目特征4           | 清单项目特征 |
| measureUnit    | 计量单位4               | 计量单位     |
| unitPrice      | 444.0                  | 综合单价     |
| sum            | 104.0                  | 工程量      |
| modelId        | 1326                   | 模型ID      |
| version        | 1                      | 模型版本     |
| dbid           | [133068,133067,133085] | 构件ID      |

### 备注

> code返回结果取值有200,502,500三种可能

## 5.发起支付流程之后的操作

### 请求URL

> /4DAnalog/cost/payFlowDone.action

### 请求方式

> POST

### 参数

|    参数名     | 必选 |  类型  |      说明       |         示例         |
| ------------ | --- | ------ | --------------- | -------------------- |
| dbid         | 是   | String | 构件Id(逗号相隔) | 137996,135341,136672 |
| modelId      | 是   | int    | 模型Id          | 1326                 |
| version      | 是   | int    | 模型版本         | 1                    |
| receivePrice | 否   | String | 认价状态         | 已认价                |
| checkPrice   | 否   | String | 核价状态         | 已核价                |
| payPeriod    | 否   | String | 支付期数         | 5                    |
| payStatus    | 否   | String | 支付状态         | 已支付                |

    在不同阶段传输对应的参数
### 返回示例

```json
{
    "msg": "接口调用成功",
    "code": "200",
    "data": "",
    "dataEncode": false
}
```

### 返回参数说明

| 参数名 |     值      |    说明     |
| ----- | ----------- | ----------- |
| code  | 200         | 查询成功     |
|       | 502         | 参数错误     |
|       | 500         | 服务端报错   |
| msg   | 接口调用成功 | 返回结果说明 |

### 备注

> code返回结果取值有200,502,500三种可能

# Excel文件导出
## 1.创建Excel文件

### 请求URL

> /4DAnalog/cmpexcel/exportExcel.action

### 请求方式

> POST

### 参数

|   参数名    | 必选 |  类型  |        说明        |            示例             |
| ---------- | --- | ------ | ----------------- | --------------------------- |
| dbids      | 否   | String | 构件Id(逗号相隔)    | 137996,135341,136672        |
| newModelId | 是   | int    | 模型Id             | 1326                        |
| newVersion | 是   | int    | 模型版本           | 1                           |
| orgModelId | 否   | int    | 原始模型           | 1326                        |
| orgVersion | 否   | int    | 原始模型版本        | 2                           |
| tableType  | 否   | String | 创建的Excel文件类型 | cmp (cmp/cmpOrg/cmpNew/org) |

    根据不同业务传输对应的参数
    Excel文件类型:cmp(对比表数据)/cmpOrg(对比原始表数据)/cmpNew(对比新表数据)/org(模型构件明细表)
    dbids:在创建org表时,导出选择构件数据,如果不传,导出所有的数据
### 返回示例

```json
{
    "msg": "接口调用成功",
    "code": "200",
    "data": "2019-12-350变更对比构件表1666_2-1 10-09-29.xlsx",
    "dataEncode": false
}
```

### 返回参数说明

| 参数名 |                       值                       |        说明        |
| ----- | --------------------------------------------- | ----------------- |
| code  | 200                                           | 查询成功           |
|       | 502                                           | 参数错误           |
|       | 500                                           | 服务端报错          |
| msg   | 接口调用成功                                    | 返回结果说明        |
| data  | 2019-12-350变更对比构件表1666_2-1 10-09-29.xlsx | 创建的Excel文件路径 |

### 备注

> code返回结果取值有200,502,500三种可能


## 2.获取可下载Excel文件网络路径

### 请求URL

> /4DAnalog/cmpexcel/downloadExcel.action

### 请求方式

> POST

### 参数

| 参数名 | 必选 |  类型  |        说明        |                      示例                      |
| ----- | --- | ------ | ----------------- | --------------------------------------------- |
| excel | 是   | String | 创建的Excel文件路径 | 2019-12-350变更对比构件表1666_2-1 10-09-29.xlsx |

    
### 返回示例

```json
{
    "msg":"接口调用成功",
    "code":"200",
    "data":"https://lan.sf.bdip.com:10099/static/modelExcel/2019-12-27/构件明细表247_1 15-01-58.xlsx",
    "dataEncode":false
}
```

### 返回参数说明

| 参数名 |                           值                           |            说明            |
| ----- | ------------------------------------------------------ | -------------------------- |
| code  | 200                                                    | 查询成功                    |
|       | 202                                                    | 文件还未创建成功,请稍后再请求 |
|       | 502                                                    | 参数错误                    |
|       | 500                                                    | 服务端报错                  |
| msg   | 接口调用成功                                            | 返回结果说明                |
| data  | https://lan.sf.bdip.com...构件明细表247_1 15-01-58.xlsx | 创建的Excel文件路径         |

### 备注

> code返回结果取值有200,202,502,500四种可能
